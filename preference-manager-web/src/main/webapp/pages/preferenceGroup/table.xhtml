<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:ui="http://java.sun.com/jsf/facelets">
    <head/>
    <body>
        <ui:composition>
            <h:form id="pm-preference-group-table">
                <div class="pm-form-buttons">
                    <a4j:commandButton
                        value="Add"
                        actionListener="#{preferenceGroupMB.processAddButton}"
                        oncomplete="Richfaces.showModalPanel('pm-preference-group-modal-panel');"
                        reRender="pm-preference-group-modal-panel-content"/>
                    <a4j:commandButton
                        value="Manage Snapshots"
                        oncomplete="Richfaces.showModalPanel('pm-snapshots-modal-panel');"
                        reRender="pm-snapshots-modal-panel-content"/>
                </div>
                <rich:tree
                    switchType="ajax">
                    <rich:recursiveTreeNodesAdaptor
                        roots="#{preferenceGroupMB.preferencesTrees}"
                        var="preferenceGroup"
                        nodes="#{preferenceGroup.children}">
                        <rich:treeNodesAdaptor 
                            var="key"
                            nodes="#{preferenceGroup.preferenceKeys}">
                            <rich:treeNode
                                id="pm-preference-node"
                                icon="/images/iconLeaf.gif"
                                iconLeaf="/images/iconLeaf.gif">
                                <h:outputText value="#{key}"/>=
                                <h:outputText value="#{preferenceGroup.preferences[key]}"/>
                                <rich:contextMenu
                                    attachTo="pm-preference-node"
                                    submitMode="ajax">
                                    <rich:menuItem
                                        value="Modify"
                                        oncomplete="Richfaces.showModalPanel('pm-preference-modal-panel');"
                                        reRender="pm-preference-modal-panel-content">
                                        <a4j:actionparam
                                            name="path"
                                            assignTo="#{preferenceMB.path}"
                                            value="#{preferenceGroup.path}"/>
                                        <a4j:actionparam
                                            name="key"
                                            assignTo="#{preferenceMB.key}"
                                            value="#{key}"/>
                                        <a4j:actionparam
                                            name="value"
                                            assignTo="#{preferenceMB.value}"
                                            value="#{preferenceGroup.preferences[key]}"
                                            actionListener="#{preferenceMB.processModifyButton}"/>
                                    </rich:menuItem>
                                    <rich:menuItem
                                        value="Delete"
                                        reRender="pm-preference-group-table">
                                        <a4j:actionparam
                                            name="path"
                                            assignTo="#{preferenceMB.path}"
                                            value="#{preferenceGroup.path}"/>
                                        <a4j:actionparam
                                            name="key"
                                            assignTo="#{preferenceMB.key}"
                                            value="#{key}"
                                            actionListener="#{preferenceMB.processDeleteButton}"/>
                                    </rich:menuItem>
                                </rich:contextMenu>
                            </rich:treeNode>
                        </rich:treeNodesAdaptor>
                        <rich:treeNode
                            id="pm-preference-group-node"
                            icon="/images/iconFolder.gif"
                            iconLeaf="/images/iconFolder.gif">
                            <h:outputText value="#{preferenceGroup}"/>
                            <rich:contextMenu
                                attachTo="pm-preference-group-node"
                                submitMode="ajax">
                                <rich:menuItem
                                    value="Add Preference"
                                    oncomplete="Richfaces.showModalPanel('pm-preference-modal-panel');"
                                    reRender="pm-preference-modal-panel-content">
                                    <a4j:actionparam
                                        name="path"
                                        assignTo="#{preferenceMB.path}"
                                        value="#{preferenceGroup.path}"/>
                                </rich:menuItem>
                                <rich:menuItem
                                    value="Move"
                                    oncomplete="Richfaces.showModalPanel('pm-preference-group-modal-panel');"
                                    reRender="pm-preference-group-modal-panel-content">
                                    <a4j:actionparam
                                        name="path"
                                        assignTo="#{preferenceGroupMB.path}"
                                        value="#{preferenceGroup.path}"
                                        actionListener="#{preferenceGroupMB.processMoveButton}"/>
                                </rich:menuItem>
                                <rich:menuItem
                                    value="Delete"
                                    reRender="pm-preference-group-table">
                                    <a4j:actionparam
                                        name="path"
                                        assignTo="#{preferenceGroupMB.path}"
                                        value="#{preferenceGroup.path}"
                                        actionListener="#{preferenceGroupMB.processDeleteButton}"/>
                                </rich:menuItem>
                            </rich:contextMenu>
                        </rich:treeNode>
                    </rich:recursiveTreeNodesAdaptor>
                </rich:tree>
            </h:form>
        </ui:composition>
    </body>
</html>
